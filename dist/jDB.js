/*!
 *  jDB v1.0.2 
 *  Author:Dharmesh 
 *  License:Apache-2.0 
 *  Homepage:https://dharmesh-hemaram.github.io/jDB/
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(window,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);const s={EQUAL:"equal",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",GREATER_THAN:"greaterThan",GREATER_THAN_OR_EQUAL:"greaterThanOrEqual",LESSER_THAN:"lesserThan",LESSER_THAN_OR_EQUAL:"lesserThanOrEqual",BETWEEN:"between"},n="~";class o{constructor(e,t,r){this.type=e,this.value=t,r&&(this.index=r.name)}}const i={ADD:"add",GET:"get",GET_ALL:"getAll",CURSOR:"openCursor",PUT:"put",DELETE:"delete",CLEAR:"clear",COUNT:"count"},a={READ_WRITE:"readwrite",READ_ONLY:"readonly"};class l{constructor(e,t,r,s,n,o,i,a){this.sKey=Symbol.for("key"),this.access=e,this.index=t,this.action=r,this[this.sKey]=s,this.values=n,this.columns=o,this.limit=i,this.start=a}set[Symbol.for("key")](e){if(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error(e+" should be of type string | number only");this.key=e}}getDB(e){return N.getInst().getDB(e)}objectStore(e,t){if(!t)throw new Error("Store is not defined");let r=this.getDB(e).transaction([t],this.access);r.oncomplete=function(e){},r.onerror=function(e){};let s=r.objectStore(t);return this.index&&("string"==typeof this.index||"number"==typeof this.index?s=s.index(this.index):reject("Only one key is alowed in update")),s}check(e){if(this.action===i.ADD){if(!e.autoIncrement&&!this.values[e.keyPath])return this.error=e.keyPath+" is not defined in "+e.name,!1;e.indexes.forEach(t=>{if(!1===t.nullable&&!this.values[t.name])return this.error=t.name+" is not defined in "+e.name,!1})}else this.action===i.CURSOR&&this.newValues;return!0}setFilter(e){if(e&&e.type)switch(this.index=e.index,e.type){case s.EQUAL:this.values=N.getInst().IDBKeyRange.only(e.value);break;case s.STARTS_WITH:this.values=N.getInst().IDBKeyRange.bound(e.value,e.value+"ï¿¿");break;case s.GREATER_THAN:this.values=N.getInst().IDBKeyRange.lowerBound(e.value,!0);break;case s.LESSER_THAN:this.values=N.getInst().IDBKeyRange.upperBound(e.value,!0);break;case s.GREATER_THAN_OR_EQUAL:this.values=N.getInst().IDBKeyRange.lowerBound(e.value,!1);break;case s.LESSER_THAN_OR_EQUAL:this.values=N.getInst().IDBKeyRange.upperBound(e.value,!1);break;case s.BETWEEN:let t=e.value.split(n);this.values=N.getInst().IDBKeyRange.bound(Number(t[0]),Number(t[1]));break;default:this.index=void 0,this.filter=e,this.action=i.CURSOR}}}class u extends l{constructor(e){super(a.READ_WRITE,void 0,i.ADD,void 0,e)}}class c extends l{constructor(){super(a.READ_WRITE,void 0,i.CLEAR)}}class h extends l{constructor(){super(a.READ_ONLY,void 0,i.COUNT)}}class d extends l{constructor(e){super(a.READ_WRITE,void 0,i.DELETE,e)}}class f extends l{constructor(e){super(a.READ_WRITE,void 0,i.PUT,void 0,e)}}class y extends l{constructor(){super(a.READ_ONLY,void 0,i.GET_ALL)}}class m extends l{constructor(e,t,r){super(a.READ_WRITE,void 0,i.CURSOR,void 0,void 0,e,t,r)}}class b extends l{constructor(e){super(a.READ_WRITE,void 0,i.CURSOR),this.newValues=e}}class E extends l{constructor(){super(a.READ_WRITE,void 0,i.CURSOR),this.newAction=i.DELETE}}class S extends Array{constructor(){super()}setDistinct(e){this.distinct=e}push(e){this.distinct&&-1!==this.indexOf(e)||this.push(e)}count(){return this.length}avg(e){if(!e||"string"!=typeof e)throw new TypeError("Please provide column to find min");let t=0;return this.forEach(r=>{(r="object"==typeof r?r[e]:r)&&(t+=Number(r))}),t/this.length}min(e){if(!e||"string"!=typeof e)throw new TypeError("Please provide column to find min");let t;return this.forEach(r=>{r="object"==typeof r?r[e]:r,(!t||t>r)&&(t=r)}),t}max(e){if(!e||"string"!=typeof e)throw new TypeError("Please provide column to find min");let t;return this.forEach(r=>{r="object"==typeof r?r[e]:r,(!t||t<r)&&(t=r)}),t}}class w{constructor(e,t,r){this[Symbol.for("databaseName")]=e,r&&(this[Symbol.for("filter")]=r),t&&(this[Symbol.for("StoreEntity")]=t)}get(e,t,r){let s;return IDBObjectStore.prototype.getAll&&void 0===e&&void 0===t&&void 0===r?s=new y:(e instanceof Array||(e=[e]),s=new m(e,t,r)),this[Symbol.for("action")](s)}getDist(e,t,r){void 0===e||e instanceof Array||(e=[e]);let s=!1;return e&&"string"==typeof colsmn?s=!0:e instanceof Array&&1===e.length&&(s=!0),this[Symbol.for("action")](new m(e,t,r),s)}update(e){return this[Symbol.for("action")](new b(e))}delete(){return this[Symbol.for("action")](new E)}[Symbol.for("action")](e,t){return e.setFilter(this[Symbol.for("filter")]),new Promise((r,s)=>{try{e.check(this[Symbol.for("StoreEntity")])?this[Symbol.for("req")](e,t,r,s):s(e.error)}catch(e){s(e)}})}[Symbol.for("req")](e,t,r,s){let n=e.objectStore(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")].name),o=new S;o.setDistinct(t);let a=n[e.action](e.values);a.onsuccess=(t=>{e.action===i.CURSOR?this[Symbol.for("cursor")](t,e,o,r):(o=t.target.result instanceof Array?o.concat(t.target.result):t.target.result,r(o))}),a.onerror=(e=>{s(e.target.error)})}[Symbol.for("cursor")](e,t,r,s){let n=e.target.result;if(t.start)n.advance(t.start),t.start=void 0;else if(n&&(!t.limit||r.arr.length<t.limit)){let e={};if(t.columns?1===t.columns.length?n.value[t.columns[0]]&&(e=n.value[t.columns[0]]):t.columns.forEach(t=>{n.value[t]&&(e[t]=n.value[t])}):e=n.value,t.filter){let r=n.value[t.filter.index];if(r)switch(t.filter.type){case"endsWith":r.endsWith(t.filter.values)||(e=void 0);break;default:console.log(t.filter.type+" condition is not handled")}}if(e)if(t.newValues){let e=Object.assign(n.value,t.newValues),s=n.update(e);s.onsuccess=(e=>{r.push(e.target.result)}),s.onerror=(e=>{reject(e.target.error)})}else if(t.newAction===i.DELETE){let e=n.delete();e.onsuccess=(e=>{r.push(e.target.result)}),e.onerror=(e=>{reject(e.target.error)})}else r.push(e);n.continue()}else t.newAction===i.DELETE&&(r=r.arr.length),s(r)}}class p extends w{constructor(e,t,r){super(e,t),this[Symbol.for("IndexEntity")]=r}equalDist(e){return this[Symbol.for("action")](ACTION.GET,ACCESS.READ_ONLY,e)}equal(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.EQUAL,e,this[Symbol.for("IndexEntity")]))}startsWith(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.STARTS_WITH,e,this[Symbol.for("IndexEntity")]))}endsWith(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.ENDS_WITH,e,this[Symbol.for("IndexEntity")]))}}class g extends p{constructor(e,t,r){super(e,t,r)}greaterThan(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.GREATER_THAN,e,this[Symbol.for("IndexEntity")]))}lesserThan(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.LESSER_THAN,e,this[Symbol.for("IndexEntity")]))}greaterThanOrEqual(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.GREATER_THAN_OR_EQUAL,e,this[Symbol.for("IndexEntity")]))}lesserThanOrEqual(e){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.LESSER_THAN_OR_EQUAL,e,this[Symbol.for("IndexEntity")]))}between(e,t){return new w(this[Symbol.for("databaseName")],this[Symbol.for("StoreEntity")],new o(s.BETWEEN,e+n+t,this[Symbol.for("IndexEntity")]))}}class R extends w{constructor(e,t){super(e,t),this.sBulkAdd=Symbol.for("bulkAdd"),t.indexes.forEach(r=>{let s;s="number"===r.type?new g(e,t,r):new p(e,t,r),this[r.name]=s}),"number"===t.type?this[t.keyPath]=new g(e,t):this[t.keyPath]=new p(e,t)}add(e){return e instanceof Array?new Promise((t,r)=>{let s={index:0};s.values=e,this[this.sBulkAdd](s,t,r)}):this[Symbol.for("action")](new u(e))}[Symbol.for("bulkAdd")](e,t,r){e.index<e.values.length?this[Symbol.for("action")](new u(e.values[e.index])).then(s=>{e.index++,this[this.sBulkAdd](e,t,r)}).catch(t=>{r(t,e.values[e.index])}):t(e.index)}clear(){return this[Symbol.for("action")](new c)}count(){return this[Symbol.for("action")](new h)}delete(e){return this[Symbol.for("action")](new d(e))}update(e,t){return t[this[Symbol.for("StoreEntity")].keyPath]=e,this[Symbol.for("action")](new f(t))}}class x{constructor(e){this[Symbol.for("databaseName")]=e.databaseName,e.stores.forEach(t=>{this[t.name]=new R(e.databaseName,t)})}delete(){return new Promise((e,t)=>{this.getDB().close();let r=DB.getInst().indexedDB.deleteDatabase(this[Symbol.for("databaseName")]);r.onsuccess=(t=>{e("Database deleted Successfully")}),r.onerror=(e=>{t(e.target.error)})})}}class v{setter(e,t,r=!1,s="string"){typeof e===s?this[t]=e:r&&!e&&this.error(t,e)}error(e,t){throw new Error(this.constructor.name+" : "+e+" is "+t)}}class D extends v{constructor(e,t=!1,r=!1,s=!0,n="string"){super(),this.setter(e,"name"),this.unique=t,this.multiEntry=r,this.type=n,this.nullable=s}static fromJSON(e){return new D(e.name,e.unique,e.multiEntry,e.nullable,e.type)}}class T extends v{constructor(e,t,r,s=!0,n="string"){super(),this.autoIncrement=s,this.setter(e,"name",!0),this.setter(t,"keyPath",!0),this.type=n,this.setIndexes=r}set setIndexes(e){this.indexes=[],"object"==typeof e&&e instanceof Array?e.forEach(e=>{e instanceof D||(e=D.fromJSON(e)),this.indexes.push(e)}):void 0!==e&&this.error("indexes",e)}static fromJSON(e){return new T(e.name,e.keyPath,e.indexes,e.autoIncrement,e.type)}}class A extends v{constructor(e,t,r){super(),this.setter(e,"databaseName",!0),this.setter(t,"version",!0,"number"),this.setStores=r}set setStores(e){if(this.stores=[],"object"==typeof e&&e instanceof Array)e.forEach(e=>{e instanceof T||(e=T.fromJSON(e)),this.stores.push(e)});else if(void 0!==e)throw new TypeError(e+" is of not of type [Object|Array]")}static fromJSON(e){return new A(e.databaseName,e.version,e.stores)}}class I{conifg(e){return new Promise((t,r)=>{let s=DB.getInst().indexedDB.open(e.databaseName,e.version);s.onupgradeneeded=(t=>{e.stores.forEach(e=>{this.createStore(t.target.result,e)}),t.target.result.onversionchange=(e=>{e.target.result.close(),alert("A new version of this page is ready. Please reload!")})}),s.onblocked=(e=>{alert("Please close all other tabs with this site open!")}),s.onsuccess=(e=>{t(e.target.result)}),s.onerror=(e=>{r(e.target.error)})})}createStore(e,t){e.objectStoreNames.contains(t.name)&&e.deleteObjectStore(t.name);let r=e.createObjectStore(t.name,{keyPath:t.keyPath,autoIncrement:t.autoIncrement});t.indexes.forEach(e=>{r.createIndex(e.name,e.name,{unique:e.unique,multiEntry:e.multiEntry})})}}class N{constructor(){this.xDB,this.DBs={},this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}setDB(e,t){this.DBs[e]=t}getDB(e){return this.DBs[e]}static getInst(){return this.xDB||(this.xDB=new N),this.xDB}static setup(e){return e instanceof A||(e=A.fromJSON(e)),new Promise((t,r)=>{(new I).conifg(e).then(r=>{this.getInst().setDB(e.databaseName,r),t(this.getInst()[e.databaseName]=new x(e))}).catch(e=>r(e))})}}t.default={DB:N,DBEntity:A,StoreEntity:T,IndexEntity:D}}]).default});