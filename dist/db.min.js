/*!
 *  DB v-1.0.2 
 *  Author: Dharmesh 
 *  License: Apache-2.0 
 *  Homepage: https://dharmesh-hemaram.github.io/DB/
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(window,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);const s={EQUAL:"equal",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",GREATER_THAN:"greaterThan",GREATER_THAN_OR_EQUAL:"greaterThanOrEqual",LESSER_THAN:"lesserThan",LESSER_THAN_OR_EQUAL:"lesserThanOrEqual",BETWEEN:"between"},n="~";class o{constructor(e,t,r){this.type=e,this.value=t,r&&(this.index=r.name)}}const i={ADD:"add",GET:"get",GET_ALL:"getAll",CURSOR:"openCursor",PUT:"put",DELETE:"delete",CLEAR:"clear",COUNT:"count"},a={READ_WRITE:"readwrite",READ_ONLY:"readonly"};class l{constructor(e,t,r,s,n,o,i,a,l){this._=e,this.sKey=Symbol.for("key"),this.access=t,this.index=r,this.action=s,this[this.sKey]=n,this.values=o,this.columns=i,this.limit=a,this.start=l}set[Symbol.for("key")](e){if(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error(e+" should be of type string | number only");this.key=e}}objectStore(e){if(!e)throw new Error("Store is not defined");let t=this._.transaction([e],this.access);t.oncomplete=function(e){},t.onerror=function(e){};let r=t.objectStore(e);return this.index&&("string"==typeof this.index||"number"==typeof this.index?r=r.index(this.index):reject("Only one key is alowed in update")),r}check(e){if(this.action===i.ADD){if(!e.autoIncrement&&!this.values[e.keyPath])return this.error=e.keyPath+" is not defined in "+e.name,!1;e.columns.forEach(t=>{if(!1===t.nullable&&!this.values[t.name])return this.error=t.name+" is not defined in "+e.name,!1})}else this.action===i.CURSOR&&this.newValues;return!0}setFilter(e){if(e&&e.type)switch(this.index=e.index,e.type){case s.EQUAL:this.values=I[Symbol.for("IDBKeyRange")]().only(e.value);break;case s.STARTS_WITH:this.values=I[Symbol.for("IDBKeyRange")]().bound(e.value,e.value+"ï¿¿");break;case s.GREATER_THAN:this.values=I[Symbol.for("IDBKeyRange")]().lowerBound(e.value,!0);break;case s.LESSER_THAN:this.values=I[Symbol.for("IDBKeyRange")]().upperBound(e.value,!0);break;case s.GREATER_THAN_OR_EQUAL:this.values=I[Symbol.for("IDBKeyRange")]().lowerBound(e.value,!1);break;case s.LESSER_THAN_OR_EQUAL:this.values=I[Symbol.for("IDBKeyRange")]().upperBound(e.value,!1);break;case s.BETWEEN:let t=e.value.split(n);this.values=I[Symbol.for("IDBKeyRange")]().bound(Number(t[0]),Number(t[1]));break;default:this.index=void 0,this.filter=e,this.action=i.CURSOR}}}class u extends l{constructor(e,t){super(e,a.READ_WRITE,void 0,i.ADD,void 0,t)}}class c extends l{constructor(e){super(e,a.READ_WRITE,void 0,i.CLEAR)}}class h extends l{constructor(e){super(e,a.READ_ONLY,void 0,i.COUNT)}}class y extends l{constructor(e,t){super(e,a.READ_WRITE,void 0,i.DELETE,t)}}class d extends l{constructor(e,t){super(e,a.READ_WRITE,void 0,i.PUT,void 0,t)}}class f extends l{constructor(e){super(e,a.READ_ONLY,void 0,i.GET_ALL)}}class m extends l{constructor(e,t,r,s){super(e,a.READ_WRITE,void 0,i.CURSOR,void 0,void 0,t,r,s)}}class b extends l{constructor(e,t){super(e,a.READ_WRITE,void 0,i.CURSOR),this.newValues=t}}class E extends l{constructor(e){super(e,a.READ_WRITE,void 0,i.CURSOR),this.newAction=i.DELETE}}class S{constructor(e,t,r,s){this._=e,this[Symbol.for("databaseName")]=t,s&&(this[Symbol.for("filter")]=s),r&&(this[Symbol.for("TableEntity")]=r)}get(e,t,r){let s,n=this[Symbol.for("ColumnEntity")];return!n&&IDBObjectStore.prototype.getAll&&void 0===e&&void 0===t&&void 0===r?s=new f(this._):(void 0!==n&&(e=[n.name]),e instanceof Array||(e=[e]),s=new m(this._,e,t,r)),this[Symbol.for("action")](s)}getDist(e,t,r){void 0===e||e instanceof Array||(e=[e]);let s=!1;return e&&"string"==typeof colsmn?s=!0:e instanceof Array&&1===e.length&&(s=!0),this[Symbol.for("action")](new m(this._,e,t,r),s)}update(e){return this[Symbol.for("action")](new b(this._,e))}delete(){return this[Symbol.for("action")](new E(this._))}[Symbol.for("action")](e,t){return e.setFilter(this[Symbol.for("filter")]),new Promise((r,s)=>{try{e.check(this[Symbol.for("TableEntity")])?this[Symbol.for("req")](e,t,r,s):s(e.error)}catch(e){s(e)}})}[Symbol.for("req")](e,t,r,s){let n=e.objectStore(this[Symbol.for("TableEntity")].name),o=new Array,a=n[e.action](e.values);a.onsuccess=(s=>{e.action===i.CURSOR?this[Symbol.for("cursor")](s,e,o,r,t):(o=s.target.result instanceof Array?o.concat(s.target.result):s.target.result,r(o))}),a.onerror=(e=>{s(e.target.error)})}[Symbol.for("cursor")](e,t,r,s,n){let o=e.target.result;if(t.start)o.advance(t.start),t.start=void 0;else if(o&&(!t.limit||r.length<t.limit)){let e={};if(t.columns?1===t.columns.length?o.value[t.columns[0]]&&(e=o.value[t.columns[0]]):t.columns.forEach(t=>{o.value[t]&&(e[t]=o.value[t])}):e=o.value,t.filter){let r=o.value[t.filter.index];if(r)switch(t.filter.type){case"endsWith":r.endsWith(t.filter.values)||(e=void 0);break;default:console.log(t.filter.type+" condition is not handled")}}if(e)if(t.newValues){let e=Object.assign(o.value,t.newValues),s=o.update(e);s.onsuccess=(e=>{r.push(e.target.result)}),s.onerror=(e=>{reject(e.target.error)})}else if(t.newAction===i.DELETE){let e=o.delete();e.onsuccess=(e=>{r.push(e.target.result)}),e.onerror=(e=>{reject(e.target.error)})}else r.push(e);o.continue()}else t.newAction===i.DELETE&&(r=r.arr.length),s(n?[...new Set(r)]:r)}}class w extends S{constructor(e,t,r,s){super(e,t,r),this[Symbol.for("ColumnEntity")]=s}equalDist(e){return this[Symbol.for("action")](ACTION.GET,ACCESS.READ_ONLY,e)}equal(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.EQUAL,e,this[Symbol.for("ColumnEntity")]))}startsWith(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.STARTS_WITH,e,this[Symbol.for("ColumnEntity")]))}endsWith(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.ENDS_WITH,e,this[Symbol.for("ColumnEntity")]))}}class p extends w{constructor(e,t,r,s){super(e,t,r,s)}greaterThan(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.GREATER_THAN,e,this[Symbol.for("ColumnEntity")]))}lesserThan(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.LESSER_THAN,e,this[Symbol.for("ColumnEntity")]))}greaterThanOrEqual(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.GREATER_THAN_OR_EQUAL,e,this[Symbol.for("ColumnEntity")]))}lesserThanOrEqual(e){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.LESSER_THAN_OR_EQUAL,e,this[Symbol.for("ColumnEntity")]))}between(e,t){return new S(this._,this[Symbol.for("databaseName")],this[Symbol.for("TableEntity")],new o(s.BETWEEN,e+n+t,this[Symbol.for("ColumnEntity")]))}}class T{setter(e,t,r=!1,s="string"){typeof e===s?this[t]=e:r&&!e&&this.error(t,e)}error(e,t){throw new Error(this.constructor.name+" : "+e+" is "+t)}}class _ extends T{constructor(e,t=!1,r=!1,s=!0,n="string"){super(),this.setter(e,"name"),this.unique=t,this.multiEntry=r,this.type=n,this.nullable=s}static fromJSON(e){return new _(e.name,e.unique,e.multiEntry,e.nullable,e.type)}}class R extends S{constructor(e,t,r){super(e,t,r),this.sBulkAdd=Symbol.for("bulkAdd"),r.columns.forEach(e=>{let s;s="number"===e.type?new p(this._,t,r,e):new w(this._,t,r,e),this[e.name]=s});let s=new _(r.keyPath,!0,!1,!1,r.type);"number"===r.type?this[r.keyPath]=new p(this._,t,r,s):this[r.keyPath]=new w(this._,t,r,s)}add(e){return e instanceof Array?new Promise((t,r)=>{let s={index:0};s.values=e,this[this.sBulkAdd](s,t,r)}):this[Symbol.for("action")](new u(this._,e))}[Symbol.for("bulkAdd")](e,t,r){e.index<e.values.length?this[Symbol.for("action")](new u(this._,e.values[e.index])).then(s=>{e.index++,this[this.sBulkAdd](e,t,r)}).catch(t=>{r(t,e.values[e.index])}):t(e.index)}clear(){return this[Symbol.for("action")](new c(this._))}count(){return this[Symbol.for("action")](new h(this._))}delete(e){return this[Symbol.for("action")](new y(this._,e))}update(e,t){return t[this[Symbol.for("TableEntity")].keyPath]=e,this[Symbol.for("action")](new d(this._,t))}}const A="Database deleted Successfully";class v{constructor(e,t){this._=e,this[Symbol.for("databaseName")]=t.databaseName,t.tables.forEach(r=>{this[r.name]=new R(e,t.databaseName,r)})}delete(){return new Promise((e,t)=>{this._.close();let r=DB[Symbol.for("IDBKeyRange")]().deleteDatabase(this[Symbol.for("databaseName")]);r.onsuccess=(()=>{e(A)}),r.onerror=(e=>{t(e.target.error)})})}}class g extends T{constructor(e,t,r,s=!0,n="string"){super(),this.autoIncrement=s,this.setter(e,"name",!0),this.setter(t,"keyPath",!0),this.type=n,this.setColumns=r}set setColumns(e){this.columns=[],"object"==typeof e&&e instanceof Array?e.forEach(e=>{e instanceof _||(e=_.fromJSON(e)),this.columns.push(e)}):void 0!==e&&this.error("columns",e)}static fromJSON(e){return new g(e.name,e.keyPath,e.columns,e.autoIncrement,e.type)}}class D extends T{constructor(e,t,r){super(),this.setter(e,"databaseName",!0),this.setter(t,"version",!0,"number"),this.setTables=r}set setTables(e){if(this.tables=[],"object"==typeof e&&e instanceof Array)e.forEach(e=>{e instanceof g||(e=g.fromJSON(e)),this.tables.push(e)});else if(void 0!==e)throw new TypeError(e+" is of not of type [Object|Array]")}static fromJSON(e){return new D(e.databaseName,e.version,e.tables)}}class x{conifg(e){return new Promise((t,r)=>{let s=DB[Symbol.for("indexedDB")]().open(e.databaseName,e.version);s.onupgradeneeded=(t=>{e.tables.forEach(e=>{this.createTable(t.target.result,e)}),t.target.result.onversionchange=(e=>{e.target.result.close(),alert("A new version of this page is ready. Please reload!")})}),s.onblocked=(()=>{alert("Please close all other tabs with this site open!")}),s.onsuccess=(e=>{t(e.target.result)}),s.onerror=(e=>{r(e.target.error)})})}createTable(e,t){e.objectStoreNames.contains(t.name)&&e.deleteObjectStore(t.name);let r=e.createObjectStore(t.name,{keyPath:t.keyPath,autoIncrement:t.autoIncrement});t.columns.forEach(e=>{r.createIndex(e.name,e.name,{unique:e.unique,multiEntry:e.multiEntry})})}}const N="Database Setup Successfully !";class I{static[Symbol.for("indexedDB")](){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}static[Symbol.for("IDBTransaction")](){return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"}}static[Symbol.for("IDBKeyRange")](){return window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange}constructor(){this.xDB}static getInst(){return this.xDB||(this.xDB=new I),this.xDB}static setup(e){return e instanceof D||(e=D.fromJSON(e)),new Promise((t,r)=>{(new x).conifg(e).then(r=>{this.getInst()[e.databaseName]=new v(r,e),t(N)}).catch(r)})}}t.default={DB:I,DBEntity:D,TableEntity:g,ColumnEntity:_}}]).default});